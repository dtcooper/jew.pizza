services:
  frontend-dev:
    restart: "on-failure"
    image: library/node:16-alpine
    working_dir: /app/frontend-dev
    command: "/bin/sh -c '[ ! -d node_modules ] && npm install; npm run watch'"
    volumes:
      - .:/app
    environment:
      - NPM_CONFIG_CACHE=/app/frontend-dev/.cache
    tty: true  # Needed for tailwind --watch to work properly

  app:
    restart: "on-failure"
    volumes:
      - ./backend:/app
      - ./entrypoint.sh:/entrypoint.sh
    ports:
      - "${LISTEN_PORT:-8000}:8000"
    depends_on:
      - frontend-dev

  db:
    restart: "on-failure"
